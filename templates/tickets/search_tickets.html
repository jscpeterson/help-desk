{% extends 'base.html' %}

{% block content %}
<div class="container">
  <div class="row text-center">
    <div class="col med 12">
      <form action="{% url 'tickets:search_tickets' %}">
        <!-- Form Row 1 -->
        <div class="form-row">
          <div class="col m4">
            <label class="sr-only">Keywords</label>
            <input type="text" name="keywords" class="form-control" placeholder="Keywords in Resolution/Notes/Problem"
            value="{{ values.keywords }}">
          </div>

          <div class="col m4">
            <label class="sr-only">Users</label>
            <input type="text" name="users" class="form-control" placeholder="User" value="{{ values.user }}">
          </div>

          <div class="col m4">
            <label class="sr-only">Assignee</label>
            <select multiple name="assignee" class="form-control">
              <option selected="true" disabled>Support Agents</option>
              {% for assignee in assignee_choices %}
              <option value="{{ assignee.id }}"
              {% if assignee.id == values.assignee.id %}
                selected
              {% endif %}>{{ assignee.username }}</option>
              {% endfor %}
            </select>
          </div>
        </div>
        <!-- Form Row 2 -->
        <div class="form-row">
          <div class="col m6">
            <label class="sr-only">Priority</label>
            <select multiple name="priority" class="form-control">
              <option selected="true" disabled="disabled">Priority Levels</option>
              {% for key, value in priority_choices %}
              <option value="{{ key }}"
              {% if key == values.priority %}
                selected
              {% endif %}>{{ value }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="col m6">
            <label class="sr-only">Category</label>
            <select multiple name="category" class="form-control">
              <option selected="true" disabled>Categories</option>
              {% for key, value in category_choices %}
              <option value="{{ key }}"
              {% if key == values.category %}
                selected
              {% endif %}>{{ value }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="col m6">
            <label class="sr-only">Status</label>
            <select multiple name="status" class="form-control">
              <option selected="true" disabled="disabled">Ticket Status</option>
              {% for key, value in status_choices %}
              <option value="{{ key }}"
              {% if key == values.status %}
                selected
              {% endif %}>{{ value }}</option>
              {% endfor %}
            </select>
          </div>
        </div>
        <div class="row">
          <div class="col s12">
            <label>Ticket Opened On Or After</label>
              <input name="openStart" type="text" class="datepicker">
            <label>Ticket Opened On Or Before</label>
              <input name="openEnd" type="text" class="datepicker">
          </div>
        </div>
        <div class="row">
          <div class="col s12">
            <label>Ticket Assigned On Or After</label>
              <input name="assignStart" type="text" class="datepicker">
            <label>Ticket Assigned On Or Before</label>
              <input name="assignEnd" type="text" class="datepicker">
          </div>
        </div>
        <div class="row">
          <div class="col s12">
            <label>Ticket Closed On Or After</label>
              <input name="closeStart" type="text" class="datepicker">
            <label>Ticket Closed On Or Before</label>
              <input name="closeEnd" type="text" class="datepicker">
          </div>
        </div>
        <div class="col s12">
          <button class="btn waves-effect waves-light hoverable blue darken-4" type="submit">Search</button>
        </div>
      </form>
    </div>
  </div>
</div>

<div class="row">
  <h4>These are the found tickets:</h4>
</div>

<div class="row"> <!-- START ROW -->
  <div id="admin" class="col s12">
    <div class="card material-table blue-grey darken-1">
      <div class="table-header">
        <span class="table-title">{{first_name}}'s Assigned Tickets</span>
      </div>
      <table class="white-text highlight">
      <thead>
          <tr>
              <th>Ticket</th>
              <th>User</th>
              <th>Opened</th>
              <th>Assigned At</th>
              <th>Category</th>
              <th>Priority</th>
              <th>Description</th>
              <th>Resolution</th>
              <th>Notes</th>
          </tr>
      </thead>
          {% for ticket in found_tickets %}
              <tr>
                  <td>{{ ticket.id }}</td>
                  <td>{{ ticket.user }}</td>
                  <td>{{ ticket.created_date }}</td>
                  <td>{{ ticket.assignment_date }}</td>
                  <td>{{ ticket.get_category_display }}</td>
                  <td>{{ ticket.get_priority_display }}</td>
                  <td>{{ ticket.problem_description }}</td>
                  <td>{{ ticket.resolution }}</td>
                  <td>{{ ticket.notes }}</td>
              </tr>
          {% endfor %}
          {% if assigned_tickets|length == 0 %}
          <tr>
            <td colspan="8">No Assigned Tickets...</td>
          </tr>
          {% endif %}
      </table>
    </div>
  </div>
</div>        <!-- CLOSE ROW -->

{% endblock %}
